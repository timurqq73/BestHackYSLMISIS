# BestHackYSLMISIS

# CHROM-метод для извлечения rPPG-сигналов

Этот проект реализует алгоритм CHROM для извлечения удаленного фотоплетизмографического сигнала (rPPG) из видео. Метод основан на анализе изменений цвета кожи, вызванных пульсацией крови, и позволяет оценивать сердечный ритм на основе видеоизображений лица. Разработан в рамках хакатона **BestHack** командой **YSL MISIS**

## Основные особенности
- **Детекция лица**: Использует MediaPipe Face Mesh для определения областей интереса (ROI).
- **Извлечение сигнала**: Реализация CHROM-метода с предобработкой и фильтрацией сигнала.
- **Оценка качества**: Расчет RMSE и MAE между предсказанным и эталонным сигналами.

## Требования
- Python 3.8+
- Зависимости:
opencv-python==4.5.5.64
mediapipe==0.8.11
numpy==1.21.5
scipy==1.7.3
scikit-learn==1.0.2

Copy

## Установка
Клонируйте репозиторий:
```
 git clone https://github.com/timurqq73/rppg-chrom.git
 cd rppg-chrom
 ```
Установите зависимости:

 ```
pip install -r requirements.txt
```

Запуск
Скачайте тестовую выборку, разархивируйте и поместите в свой проект
https://drive.google.com/file/d/1JR3kWxtSNl-tuFy3DKl3ByNH-lHPAUFB/view?usp=drive_link

bash
```
python main.py
```
Скрипт автоматически:

Обработает видео из test/

Извлечёт rPPG-сигнал с использованием CHROM-метода

Рассчитает RMSE и MAE между предсказанным и эталонным сигналами

Детали реализации
Обработка ROI
Обнаружение лица:

Используется MediaPipe Face Mesh для определения 468 ключевых точек лица.

Выбираются 15 ключевых точек, соответствующих областям лба и щёк, где пульсация крови наиболее заметна.

На основе этих точек вычисляется bounding box, который используется для выделения ROI.

Извлечение цветовых каналов:

Для каждого кадра видео вычисляется среднее значение интенсивности пикселей в ROI для каждого из цветовых каналов (R, G, B).

Эти значения сохраняются для последующей обработки.

Предобработка сигнала:

Удаление полиномиального тренда (2-й порядок) для устранения медленных изменений, вызванных движением или изменением освещения.

Баттерворт-фильтрация (0.75-2.5 Гц) для выделения частот, соответствующих сердечному ритму.

Min-max нормализация для приведения сигнала к диапазону [0, 1].

Почему CHROM?
В процессе разработки мы рассмотрели множество подходов, включая:

3D CNN: Попытка обучить сверточную нейронную сеть для извлечения rPPG-сигнала. Несмотря на высокую точность на обучающих данных, модель плохо обобщалась на тестовых данных.

Регрессионные головы: Добавление регрессионных голов к предобученным моделям (например, ResNet). Этот подход показал хорошие результаты, но требовал значительных вычислительных ресурсов.

Различные методы обработки шумов: Мы экспериментировали с фильтрами Калмана, вейвлет-преобразованиями и другими методами для устранения шумов, вызванных движением или изменением освещения.

Методы выбора сегмента видео: Мы пробовали различные подходы к выбору наиболее информативного сегмента видео для построения пульсовой волны, включая анализ спектра и временных окон.

В конечном итоге, CHROM-метод показал наилучший баланс между точностью и вычислительной эффективностью. Он устойчив к изменениям освещения и движениям, что делает его идеальным выбором для нашей задачи.

Пример вывода
```
- RMSE: 0.0452
- MAE: 0.0321
```
Возможные улучшения
Интеграция с другими методами (POS, ICA)

Поддержка GPU-ускорения через CuPy

Реализация real-time обработки

Лицензия
MIT License (см. файл LICENSE)

